//@ edition:2024
//@ compile-flags: -Z validate-mir -Zunstable-options
//@ run-rustfix

#![deny(if_let_rescope)]
#![feature(if_let_rescope)]

struct Droppy;
impl Drop for Droppy {
    fn drop(&mut self) {
        println!("dropped");
    }
}
impl Droppy {
    fn get_ref(&self) -> Option<&u8> {
        None
    }
}

fn do_something<T>(_: &T) {}

fn main() {
    let binding = Droppy;
    do_something(match binding.get_ref()  { Some(value) => { value } _ => { &0 }});
    //~^ ERROR: temporary value dropped while borrowed
}
